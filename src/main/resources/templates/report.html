<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <div style="width: 75%;">
    <canvas id="pulseChart"></canvas>
  </div>

  <script th:inline="javascript">
    /*<![CDATA[*/ // Thymeleaf 템플릿이라는 것을 명시

    // 4. [마법] model.addAttribute("pulses", dataList)로 넘긴 Java List를
    //    'pulses'라는 JavaScript 변수(JSON 배열)로 '자동 변환'합니다.
    const javaData = /*[[${pulses}]]*/ [];

    // 5. JavaScript로 데이터 가공하기
    // (Chart.js는 '날짜 레이블'과 '커밋 값'을 분리해야 합니다.)
    const labels = javaData.map(item => item.date.substring(0, 10)); // "YYYY-MM-DD"
    const values = javaData.map(item => item.commitNum);

    // 6. Chart.js로 그래프 그리기
    const ctx = document.getElementById('pulseChart').getContext('2d');
    new Chart(ctx, {
      type: 'line', // 'line', 'bar' 등
      data: {
        labels: labels.reverse(), // (최신순 -> 과거순으로 변경)
        datasets: [{
          label: 'GitHub Push 횟수',
          data: values.reverse(),
          borderColor: 'rgba(75, 192, 192, 1)',
          tension: 0.1
        }]
      }
    });

    /*]]>*/
  </script>
</head>
<body>
<h1>나의 개발 리포트</h1>
<div th:each="pulse : ${pulses}">
  <p>
    블로그 이름 : <span th:text="${pulse.blogName}">블로그 이름</span>
  </p>
  <p>
    커밋수 : <span th:text="${pulse.commitNum}">커밋수</span>
  </p>
</div>
</body>
</html>